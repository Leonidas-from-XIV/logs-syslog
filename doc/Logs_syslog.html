<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="next" href="Logs_syslog_unix.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Logs_syslog" rel="Chapter" href="Logs_syslog.html">
<link title="Logs_syslog_unix" rel="Chapter" href="Logs_syslog_unix.html">
<link title="Logs_syslog_lwt" rel="Chapter" href="Logs_syslog_lwt.html">
<link title="Logs_syslog_lwt_tls" rel="Chapter" href="Logs_syslog_lwt_tls.html">
<link title="Logs_syslog_mirage" rel="Chapter" href="Logs_syslog_mirage.html">
<link title="Logs_syslog_mirage_tls" rel="Chapter" href="Logs_syslog_mirage_tls.html"><title>Logs_syslog</title>
</head>
<body>
<div class="navbar">&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="Logs_syslog_unix.html" title="Logs_syslog_unix">Next</a>
</div>
<h1>Module <a href="type_Logs_syslog.html">Logs_syslog</a></h1>

<pre><span class="keyword">module</span> Logs_syslog: <code class="code"><span class="keyword">sig</span></code> <a href="Logs_syslog.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info module top">
Logs reporter using syslog
<p>

    The <a href="http://erratique.ch/software/logs/doc/Logs.html">logs</a> library
    provides basic logging support, each log source has an independent logging
    level, and reporting is decoupled from logging.
<p>

    This library implements log reporters via syslog, using
    <a href="http://verbosemo.de/syslog-message/">syslog-message</a>.
<p>

    A variety of transport mechanisms are implemented:
    <ul>
<li><a href="https://tools.ietf.org/html/rfc3164">RFC 3164</a> specifies the original
       BSD syslog protocol over UDP on port 514 (also
       <a href="https://tools.ietf.org/html/rfc5426">RFC 5426</a>).</li>
<li><a href="https://tools.ietf.org/html/rfc6587">RFC 6587</a> specifies the historic
       syslog over TCP on port 514.</li>
<li><a href="https://tools.ietf.org/html/rfc5425">RFC 5425</a> specifies syslog over
       TLS on TCP port 6514.</li>
</ul>

<p>

    The UDP transport sends each log message to the remote log host using
    <code class="code">sendto</code>.  If <code class="code">sendto</code> raises an <code class="code"><span class="constructor">Unix</span>.<span class="constructor">Unix_error</span></code>, this error is printed
    together with the log message on standard error.
<p>

    When using a stream transport, TCP or TLS, the creation of a reporter
    attempts to establish a connection to the log host, and only results in <code class="code"><span class="constructor">Ok</span></code>
    <code class="code"><span class="constructor">Logs</span>.reporter</code> on success, otherwise the <code class="code"><span class="constructor">Error</span> msg</code> is returned.  At
    runtime when the connection failed, the message is printed on standard
    error, and a re-establishment of the connection is attempted.
<p>

    Syslog messages need to be framed when transported over TCP and TLS streams.
    In the historical <a href="https://tools.ietf.org/html/rfc6587">RFC 6587</a> this is
    defined to be either non-transparent (which lets you stream the message), by
    terminating each syslog message with a line feed (0x0A), a null byte (0x00),
    a CR-LF sequence, or any custom byte sequence.  The alternative is octet
    counting, also defined in <a href="https://tools.ietf.org/html/rfc5425">RFC 5425</a>,
    which prepends the message with the message length, ASCII-encoded as decimal
    number, followed by a whitespace (0x20).  We support all three popular
    methods, and also a <code class="code"><span class="keywordsign">`</span><span class="constructor">Custom</span></code> one appending any byte sequence at the end of
    each message.  There are defaults (TCP: null byte, TLS: octet counting)
    passed to the individual reporter constructors (see the <a href="Logs_syslog.html#TYPEframing"><code class="code"><span class="constructor">Logs_syslog</span>.framing</code></a> type
    below).
<p>

    Every time a library logs a message which reaches the reporter (depending on
    log level), the function <a href="Logs_syslog.html#VALmessage"><code class="code"><span class="constructor">Logs_syslog</span>.message</code></a> is evaluated with the <code class="code">hostname</code>
    provided while creating the reporter, the log level is mapped to a syslog
    level, and the current timestamp is added.  The log message is prepended
    with the log source name.
<p>

    This module contains the pure fragments shared between the effectful
    implementation for <a href="Logs_syslog_unix.html">Unix</a>, <a href="Logs_syslog_lwt.html">Lwt</a>, and
    <a href="Logs_syslog_mirage.html">MirageOS</a>.  TLS support is available for
    <a href="Logs_syslog_lwt_tls.html">Lwt</a> and <a href="Logs_syslog_mirage_tls.html">MirageOS</a>.
<p>

    Not implemented is the reliable transport for syslog (see
    <a href="https://tools.ietf.org/html/rfc3195">RFC 3195</a>) (using port 601), which is
    an alternative transport of syslog messages over TCP.
<p>

    <em>0.0.1-1-g4b037f6 - <a href="https://github.com/hannesm/logs-syslog ">homepage</a></em><br>
</div>
<hr width="100%">

<pre><span id="VALmessage"><span class="keyword">val</span> message</span> : <code class="type">?facility:Syslog_message.facility -><br>       host:string -><br>       source:string -><br>       tags:Logs.Tag.set -><br>       ?header:string -> Logs.level -> Ptime.t -> string -> Syslog_message.t</code></pre><div class="info ">
<code class="code">message ~facility ~host ~source ~tags ~header level now msg</code> is <code class="code">message</code>,
    a syslog message with the given values.  The default <code class="code">facility</code> is
    <code class="code"><span class="constructor">Syslog_message</span>.<span class="constructor">System_Daemons</span></code>.<br>
</div>

<pre><span id="TYPEframing"><span class="keyword">type</span> <code class="type"></code>framing</span> = <code class="type">[ `Count | `Custom of string | `LineFeed | `Null ]</code> </pre>
<div class="info ">
Different framing methods used in the wild, as described in
    <a href="https://tools.ietf.org/html/rfc6587">RFC 6587</a><br>
</div>


<pre><span id="VALframe_message"><span class="keyword">val</span> frame_message</span> : <code class="type">string -> <a href="Logs_syslog.html#TYPEframing">framing</a> -> string</code></pre><div class="info ">
<code class="code">frame_msg msg framing</code> is <code class="code">framed_message</code>, where the <code class="code">framing</code> is
    applied.<br>
</div>

<pre><span id="VALppf"><span class="keyword">val</span> ppf</span> : <code class="type">Format.formatter</code></pre><div class="info ">
<code class="code">ppf</code> is a formatter<br>
</div>

<pre><span id="VALflush"><span class="keyword">val</span> flush</span> : <code class="type">unit -> string</code></pre><div class="info ">
<code class="code">flush ()</code> flushes the formatter, and return the <code class="code">text</code><br>
</div>
</body></html>